#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ ÑÐ±Ð¾Ñ€ÐºÐ¸ overlay-only Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ ZeroOmega Failure Catcher
echo "ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ° overlay-only Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ ZeroOmega Failure Catcher..."

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸
BUILD_DIR="build-overlay"
rm -rf "$BUILD_DIR"
mkdir -p "$BUILD_DIR"

# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ overlay Ñ„Ð°Ð¹Ð»Ñ‹
echo "ðŸ“ ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ overlay Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
cp -r omega-target-chromium-extension/overlay/* "$BUILD_DIR/"

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ README Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸
cat > "$BUILD_DIR/INSTALL.md" << 'EOF'
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ ZeroOmega Failure Catcher

## Ð¡Ð¿Ð¾ÑÐ¾Ð± 1: Unpacked Extension (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸)

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Orion Ð¸Ð»Ð¸ Chromium
2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² **Settings â†’ Extensions** (Ð¸Ð»Ð¸ **chrome://extensions/**)
3. Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ **Developer Mode** (Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ð² Ð¿Ñ€Ð°Ð²Ð¾Ð¼ Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ ÑƒÐ³Ð»Ñƒ)
4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **Load Unpacked**
5. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ Ñ ÑÑ‚Ð¸Ð¼ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸ÐµÐ¼
6. Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ Ð¸ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ð² ÑÐ¿Ð¸ÑÐºÐµ

## Ð¡Ð¿Ð¾ÑÐ¾Ð± 2: Ð£Ð¿Ð°ÐºÐ¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ

1. Ð’ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ Ð¿ÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² **Settings â†’ Extensions**
2. Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ **Developer Mode**
3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **Pack Extension**
4. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ Ñ ÑÑ‚Ð¸Ð¼ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸ÐµÐ¼
5. Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ .crx Ñ„Ð°Ð¹Ð»
6. ÐŸÐµÑ€ÐµÑ‚Ð°Ñ‰Ð¸Ñ‚Ðµ .crx Ñ„Ð°Ð¹Ð» Ð² Ð¾ÐºÐ½Ð¾ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸:
1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ popup Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ (Ð¸ÐºÐ¾Ð½ÐºÐ° Ð² Ð¿Ð°Ð½ÐµÐ»Ð¸ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²)
2. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ð¹Ñ‚Ð¸ Ð½Ð° Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÑÐ°Ð¹Ñ‚ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, test123456789.com)
3. Ð’ popup Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ñ‹Ð¹ Ð´Ð¾Ð¼ÐµÐ½
4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Add selected to Proxy" Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð½Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ endpoint

## Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ endpoint

Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð½Ð°: http://127.0.0.1:9099/add-domain
Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ð²Ð°Ñ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÑÐµÑ€Ð²Ð¸Ñ.

## Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸

- âœ… Ð—Ð°Ñ…Ð²Ð°Ñ‚ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ñ‹Ñ… ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (network errors + HTTP â‰¥ 400)
- âœ… Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² Ñ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°Ð¼Ð¸ (ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸)
- âœ… Select all / Clear selection / Clear all
- âœ… Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð²
- âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² Ð² Ð¿Ñ€Ð¾ÐºÑÐ¸
- âœ… Ð ÑƒÑ‡Ð½Ð¾Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð²
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² (PRUNE)
- âœ… ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
- âœ… ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ hits Ð´Ð»Ñ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰Ð¸Ñ…ÑÑ Ð¾ÑˆÐ¸Ð±Ð¾Ðº

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

- **MV3 classic service worker** (Ð±ÐµÐ· Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹)
- **Ring buffer** - Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ ~200 ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- **Debounce** - Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ñ…ÑÑ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹
- **Normalize** - Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ IPs Ð¸ telemetry/CDN noise
- **Message API** - GET/CLEAR/PRUNE/ADD_TO_PROXY
EOF

echo "âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
echo "ðŸ“ Ð¤Ð°Ð¹Ð»Ñ‹ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² Ð¿Ð°Ð¿ÐºÐµ: $BUILD_DIR"
echo "ðŸ“– Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð¿Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ: $BUILD_DIR/INSTALL.md"
echo ""
echo "ðŸš€ Ð”Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð² Orion/Chromium:"
echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Settings â†’ Extensions"
echo "2. Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Developer Mode"
echo "3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Load Unpacked"
echo "4. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ: $BUILD_DIR"
echo ""
echo "ðŸ“¦ Ð¤Ð°Ð¹Ð»Ñ‹ Ð² ÑÐ±Ð¾Ñ€ÐºÐµ:"
ls -la "$BUILD_DIR"
